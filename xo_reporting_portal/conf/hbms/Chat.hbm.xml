<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<!-- Generated 27-Oct-2014 07:17:17 by Hibernate Tools 4.3.1 -->
<hibernate-mapping>
  <class  name="com.xo.web.ext.chat.models.Chat"  table="chat">
    <id name="messageId" type="java.lang.Integer">
            <column name="message_id" />
            <generator class="identity" />
    </id>
    <many-to-one class="com.xo.web.ext.chat.models.ChatRoom" fetch="select" name="chatroom">
      <column length="40" name="chatroom_id" not-null="true"/>
    </many-to-one>
    <property name="ts" type="timestamp">
      <column length="100" name="ts"/>
    </property>
    <many-to-one class="com.xo.web.models.system.User" fetch="select" name="user">
      <column length="40" name="user_id" not-null="true"/>
    </many-to-one>
    <property name="type" type="string">
      <column length="500" name="type" />
    </property>
    <property name="message" type="string">
      <column length="500" name="message" />
    </property>
    <property name="imagedata" type="binary">
        <column name="imagedata" not-null="true" ></column>
    </property>
  </class>
   <query name="com.xo.web.ext.chat.models.Chat.findAllChatsByRoom">
        <![CDATA[
            SELECT chat FROM com.xo.web.ext.chat.models.Chat chat WHERE chat.chatroom.chatroomId = :chatroomid
        ]]>
    </query>
    <sql-query name="com.xo.web.ext.chat.models.Chat.limitChatsByRoom">
    <![CDATA[
    		SELECT con.chatroom_id, con.message_id,con.message, con.imagedata, con.ts, con.type, usr.first_name FROM chat con JOIN users usr on con.user_id=usr.user_id WHERE con.chatroom_id = ? ORDER BY con.message_id DESC LIMIT ?
		]]>
    </sql-query>
</hibernate-mapping>
